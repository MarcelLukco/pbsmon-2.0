services:
  api:
    build:
      context: ./api
      dockerfile: Dockerfile.dev
    container_name: pbsmon-api-dev
    restart: unless-stopped
    ports:
      - "4000:4000"
    environment:
      - NODE_ENV=development
      - PORT=4000
      - MOCK_PBS_DATA=true
      - PERUN_DATA_PATH=data/perun
      - SESSION_SECRET=your-development-session-secret
      - MOCK_ADMIN=true
    env_file:
      - ./api/.env
    volumes:
      - ./api/src:/app/src
      - ./api/package.json:/app/package.json
      - ./api/tsconfig.json:/app/tsconfig.json
      - ./api/tsconfig.build.json:/app/tsconfig.build.json
      - ./api/nest-cli.json:/app/nest-cli.json
      - ./api/data:/app/data
    networks:
      - pbsmon-dev-network
    command: npm run start:dev

  web:
    build:
      context: ./web
      dockerfile: Dockerfile.dev
    container_name: pbsmon-web-dev
    restart: unless-stopped
    ports:
      - "5173:5173"
    environment:
      - NODE_ENV=development
      - API_BASE_URL=http://localhost:4000
    volumes:
      - ./web/src:/app/src
      - ./web/public:/app/public
      - ./web/index.html:/app/index.html
      - ./web/package.json:/app/package.json
      - ./web/tsconfig.json:/app/tsconfig.json
      - ./web/vite.config.js:/app/vite.config.js
      - ./web/vite-plugin-api-client.js:/app/vite-plugin-api-client.js
      - ./web/scripts:/app/scripts
    networks:
      - pbsmon-dev-network
    command: npm run dev -- --host 0.0.0.0

networks:
  pbsmon-dev-network:
    driver: bridge
